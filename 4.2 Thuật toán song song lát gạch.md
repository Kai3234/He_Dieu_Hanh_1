# Mục tiêu
- Hiểu động cơ và ý tưởng của thuật toán song song theo ô (tiled parallel algorithms).
    
- Giảm thiểu ảnh hưởng hạn chế của băng thông bộ nhớ đối với hiệu suất của kernel song song.
    
- Sử dụng thuật toán theo ô và đồng bộ hóa rào cản (barrier synchronization).

# Mô hình truy cập bộ nhớ toàn cục của Kernal nhân ma trận cơ bản (Matrix Multiplication Kernal)
[[Các luồng (thread)]] (Thread 1, Thread 2, …) truy cập [[bộ nhớ toàn cục (Global memory)]] (Global Memory).
![[Pasted image 20250218145341.png]]
 Mẫu truy cập bộ nhớ toàn cầu của kernel nhân ma trận cơ bản. Điểm quan trọng là [[Các luồng (thread)]] (Thread 1, Thread 2, …) thường truy cập vào cùng một vị trí bộ nhớ cho các toán hạng đầu vào của chúng.

Khi nói về việc sản xuất P00 và P01 đã đề cập rằng các luồng sản xuất hai phần tử này truy cập vào cùng một hàng của ma trận M trong quá trình tính toán của chúng. Những truy cập dư thừa vào cùng một vị trí bộ nhớ này có xu hướng làm tăng lưu lượng và áp lực lên hệ thống DRAM.

# Ý tưởng cơ bản của Tiling&Blocking
- Chia bộ nhớ toàn cục thành các ô nhỏ (tiles).
    
- Các luồng tập trung tính toán trên một hoặc một số ô nhỏ tại một thời điểm.
    
- Sử dụng bộ nhớ trên chip để lưu trữ ô nhỏ thay vì truy cập trực tiếp bộ nhớ toàn cục.
- 
![[Pasted image 20250218145414.png]]
Hình trên minh họa khái niệm cơ bản của các thuật toán song song theo kiểu gạch. Khi nhiều luồng truy cập vào cùng một vị trí [[bộ nhớ toàn cục (Global memory)]] (Global Memory). chúng ta có thể giảm số lần truy cập vào bộ nhớ toàn cầu bằng cách tải nội dung bộ nhớ toàn cầu vào bộ nhớ trên chip một lần, và sau đó để tất cả [[Các luồng (thread)]] (Thread 1, Thread 2, …) truy cập các toán hạng đầu vào của chúng từ bộ nhớ trên chip.

Thường thì dữ liệu trong bộ nhớ toàn cầu quá lớn để vừa vặn vào bộ nhớ trên chip. Vì vậy, điều quan trọng là chúng ta phải chia nhỏ nội dung bộ nhớ toàn cầu thành các đống. Trong một số trường hợp, trong tài liệu, chúng được gọi là các khối. Thật không may, thuật ngữ "khối" xung đột với tên gọi "[[khối luồng]]"(thread blocks). Vì vậy, trong khóa học này, chúng ta sẽ sử dụng thuật ngữ "đống" và "xếp chồng".

Chúng ta cũng cần chia nhỏ việc thực thi của  [[Các luồng (thread)]] thành các giai đoạn, để mỗi giai đoạn sẽ tập trung vào một gạch cụ thể của nội dung bộ nhớ. Nếu chúng ta có thể để tất cả  [[Các luồng (thread)]] thực thi cùng một giai đoạn, thì chúng ta chỉ cần tải gạch sẽ được tiêu thụ bởi tất cả  trong giai đoạn cụ thể đó vào bộ nhớ trên chip.

Và sau đó, tất cả  [[Các luồng (thread)]] sẽ tiêu thụ toán hạng đầu vào của chúng từ bộ nhớ trên chip trong giai đoạn đó.
![[Pasted image 20250218145720.png]]
Mục đích :
+Tải ô tiếp theo vào bộ nhớ trên chip để chuẩn bị cho giai đoạn thực thi tiếp theo.

+Đảm bảo tất cả  [[Các luồng (thread)]] có thể truy cập các tham số đầu vào của chúng từ bộ nhớ trên chip trong giai đoạn tiếp theo.
# Khái niệm cơ bản của Tiling
- Trong một hệ thống giao thông đông đúc, giảm số lượng xe cộ đáng kể có thể cải thiện độ trễ.
    
- Ví dụ:
    
    - Đi chung xe (Carpooling) giúp giảm số xe trên đường.
        
    - Tiling giúp giảm số lần truy cập bộ nhớ toàn cục.
        
- Liên hệ với lập trình:
    
    - Tài xế = Luồng truy cập bộ nhớ.
        
    - Xe = Yêu cầu truy cập bộ nhớ. 
    
         ![[Pasted image 20250218145813.png]]
         
Mục tiêu:
+Triển khai chiến lược chia sẻ tải cho các yêu cầu truy cập bộ nhớ nhằm giảm thiểu tình trạng tắc nghẽn

+Tối ưu hóa quản lý luồng nhằm cho phép nhiều luồng cùng chia sẻ quyền truy cập vào bộ nhớ

+Phát triển các giao thức cho hệ thống nhằm quản lý truy cập vào bộ nhớ không được kiểm soát một cách hiệu quả hơn.

# Một số tính toán khó áp dụng kỹ thuật Tiling hơn
 - Một số nhóm đi chung xe dễ tổ chức hơn nhóm khác.
    
- Những người tham gia đi chung xe cần có lịch trình làm việc tương đồng.
    
- Một số phương tiện phù hợp hơn để đi chung xe.
    
- Trong tính toán song song, các bài toán khác nhau có mức độ phù hợp khác nhau với kỹ thuật Tiling.
![[Pasted image 20250218145912.png]]
# Đồng bộ hóa trong đi chung xe (Carpooling)
+)Tác động tốt
**Tốt**: Khi mọi người có lịch trình tương tự.
![[Pasted image 20250218145951.png]]



+)Tác động xấu
**Xấu**: Khi mọi người có lịch trình khác nhau đáng kể.
![[Pasted image 20250218150028.png]]


# Đồng bộ hóa trong Tiling
- **Tốt**: Khi các luồng có thời gian truy cập bộ nhớ tương đồng.
    ![[Pasted image 20250218150228.png]]
    
- **Xấu**: Khi các luồng có thời gian truy cập bộ nhớ quá khác nhau.
# Đồng bộ hóa rào cản trong Tiling
  
 Đảm bảo tất cả các luồng hoàn thành một giai đoạn trước khi chuyển sang giai đoạn tiếp theo.
![[Pasted image 20250218150333.png]]

# Các bước áp dụng kỹ thuật Tiling
1. Xác định một ô trong bộ nhớ toàn cục mà nhiều luồng cần truy cập.
    
2. Nạp ô đó từ bộ nhớ toàn cục vào bộ nhớ trên chip.
    
3. Sử dụng đồng bộ hóa rào cản để đảm bảo tất cả các luồng sẵn sàng trước khi bắt đầu giai đoạn tính toán.
    
4. Các luồng truy cập dữ liệu từ bộ nhớ trên chip thay vì bộ nhớ toàn cục.
    
5. Sử dụng đồng bộ hóa rào cản để đảm bảo tất cả các luồng hoàn thành giai đoạn hiện tại.
    
6. Chuyển sang ô tiếp theo và lặp lại quá trình.

 

 






